# Entity Documentation

## Core Entities

| Entity ID | Entity Name  | Attributes                                                                                                                                                                                                                                                                                                                                                         | PK      | FK                                                                           | Relationships                                                                                                                                                                         | Description                                             |
| --------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------- |
| E-01      | User         | UserId:GUID (PK), Email:VARCHAR(50) (Unique), PasswordHash:VARCHAR(255), FullName:VARCHAR(100), Phone:VARCHAR(20), RoleId:GUID (FK), AccountStatusId:GUID (FK), CreatedAt:DATETIME, LastLogin:DATETIME                                                                                                                                                             | UserId  | RoleId → UserRole(RoleId), AccountStatusId → AccountStatus(AccountStatusId)  | 1–N with Map, 1–N with Organization, 1–N with Membership, 1–N with Bookmark, 1–N with Comment, 1–N with Notification, 1–N with SupportTicket, 1–N with Export, 1–N with Collaboration | System users with authentication and role-based access  |
| E-02      | Map          | MapId:GUID (PK), UserId:GUID (FK), OrgId:GUID (FK), MapName:VARCHAR(100), Description:TEXT, PreviewImage:VARCHAR(255), IsTemplate:BOOLEAN, ParentMapId:GUID (FK), Category:ENUM, IsFeatured:BOOLEAN, UsageCount:INT, DefaultBounds:VARCHAR(255), BaseLayer:VARCHAR(50), ViewState:TEXT, IsPublic:BOOLEAN, IsActive:BOOLEAN, CreatedAt:DATETIME, UpdatedAt:DATETIME | MapId   | UserId → User(UserId), OrgId → Organization(OrgId), ParentMapId → Map(MapId) | N–1 with User, N–1 with Organization, 1–N with Map (self-reference), 1–N with Bookmark, 1–N with Annotation, 1–N with Comment, 1–N with Export                                        | Core map entity storing map configurations and metadata |
| E-03      | Organization | OrgId:GUID (PK), OrgName:VARCHAR(100), Abbreviation:VARCHAR(20), Description:TEXT, LogoUrl:VARCHAR(255), ContactEmail:VARCHAR(100), ContactPhone:VARCHAR(20), Address:TEXT, OwnerUserId:GUID (FK), CreatedAt:DATETIME, UpdatedAt:DATETIME, IsActive:BOOLEAN                                                                                                        | OrgId   | OwnerUserId → User(UserId)                                                   | 1–N with User (owner), 1–N with Map, 1–N with Membership, 1–N with OrganizationMember                                                                                                 | Organizations that can own maps and have members        |
| E-04      | Layer        | LayerId:GUID (PK), UserId:GUID (FK), LayerName:VARCHAR(100), LayerType:ENUM, SourceType:ENUM, FilePath:VARCHAR(255), LayerData:TEXT, LayerStyle:TEXT, IsPublic:BOOLEAN, CreatedAt:DATETIME, UpdatedAt:DATETIME                                                                                                                                                     | LayerId | UserId → User(UserId)                                                        | N–1 with User, 1–N with Comment                                                                                                                                                       | Map layers with different types and sources             |

## Membership & Subscription Entities

| Entity ID | Entity Name      | Attributes                                                                                                                                                                                                                                                                                                                                                          | PK           | FK                                                                                                               | Relationships                                                                                                         | Description                                                        |
| --------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| E-05      | Membership       | MembershipId:GUID (PK), UserId:GUID (FK), OrgId:GUID (FK), PlanId:INT (FK), StartDate:DATETIME, EndDate:DATETIME, StatusId:GUID (FK), AutoRenew:BOOLEAN, CurrentUsage:TEXT, LastResetDate:DATETIME, CreatedAt:DATETIME, UpdatedAt:DATETIME                                                                                                                          | MembershipId | UserId → User(UserId), OrgId → Organization(OrgId), PlanId → Plan(PlanId), StatusId → MembershipStatus(StatusId) | N–1 with User, N–1 with Organization, N–1 with Plan, N–1 with MembershipStatus, 1–N with Transaction, 1–N with Export | User membership subscriptions to organizations with specific plans |
| E-06      | Plan             | PlanId:INT (PK), PlanName:VARCHAR(100), Description:TEXT, PriceMonthly:DECIMAL, DurationMonths:INT, MaxOrganizations:INT, MaxLocationsPerOrg:INT, MaxMapsPerMonth:INT, MaxUsersPerOrg:INT, MapQuota:INT, ExportQuota:INT, MaxCustomLayers:INT, PrioritySupport:BOOLEAN, Features:TEXT, AccessToolIds:TEXT, IsActive:BOOLEAN, CreatedAt:DATETIME, UpdatedAt:DATETIME | PlanId       |                                                                                                                  | 1–N with Membership                                                                                                   | Subscription plans defining features and quotas                    |
| E-07      | MembershipStatus | StatusId:GUID (PK), StatusName:VARCHAR(50)                                                                                                                                                                                                                                                                                                                          | StatusId     |                                                                                                                  | 1–N with Membership                                                                                                   | Status of membership (active, expired, suspended, etc.)            |
| E-08      | MembershipAddon  | AddonId:GUID (PK), AddonName:VARCHAR(100), Description:TEXT, Price:DECIMAL, DurationMonths:INT, Features:TEXT, IsActive:BOOLEAN                                                                                                                                                                                                                                     | AddonId      |                                                                                                                  |                                                                                                                       | Additional features that can be added to memberships               |
| E-09      | MembershipUsage  | UsageId:GUID (PK), MembershipId:GUID (FK), UsageType:VARCHAR(50), UsageCount:INT, ResetDate:DATETIME, CreatedAt:DATETIME                                                                                                                                                                                                                                            | UsageId      | MembershipId → Membership(MembershipId)                                                                          | N–1 with Membership                                                                                                   | Track usage of membership quotas and limits                        |

## Transaction & Payment Entities

| Entity ID | Entity Name    | Attributes                                                                                                                                                                                                                                | PK            | FK                                                                                                                 | Relationships                                                 | Description                                          |
| --------- | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------- | ---------------------------------------------------- |
| E-10      | Transactions   | TransactionId:GUID (PK), PaymentGatewayId:GUID (FK), TransactionReference:VARCHAR(100), Amount:DECIMAL, Status:VARCHAR(20), TransactionDate:DATETIME, CreatedAt:DATETIME, MembershipId:GUID (FK), ExportId:INT (FK), Purpose:VARCHAR(100) | TransactionId | PaymentGatewayId → PaymentGateway(GatewayId), MembershipId → Membership(MembershipId), ExportId → Export(ExportId) | N–1 with PaymentGateway, N–1 with Membership, N–1 with Export | Payment transactions for memberships and exports     |
| E-11      | PaymentGateway | GatewayId:GUID (PK), GatewayName:VARCHAR(50), GatewayType:ENUM, Configuration:TEXT, IsActive:BOOLEAN                                                                                                                                      | GatewayId     |                                                                                                                    | 1–N with Transactions                                         | Payment gateway configurations (PayOS, Stripe, etc.) |

## Collaboration & Access Control Entities

| Entity ID | Entity Name             | Attributes                                                                                                                                                                         | PK              | FK                                                                                                                                                    | Relationships                                                                                              | Description                                               |
| --------- | ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- |
| E-12      | Collaboration           | CollaborationId:INT (PK), TargetTypeId:GUID (FK), TargetId:VARCHAR(50), UserId:GUID (FK), PermissionId:GUID (FK), InvitedBy:GUID (FK), CreatedAt:DATETIME, UpdatedAt:DATETIME      | CollaborationId | TargetTypeId → CollaborationTargetType(TypeId), UserId → User(UserId), PermissionId → CollaborationPermission(PermissionId), InvitedBy → User(UserId) | N–1 with CollaborationTargetType, N–1 with User, N–1 with CollaborationPermission, N–1 with User (inviter) | User collaborations on maps, layers, or organizations     |
| E-13      | CollaborationTargetType | TypeId:GUID (PK), TypeName:VARCHAR(50)                                                                                                                                             | TypeId          |                                                                                                                                                       | 1–N with Collaboration                                                                                     | Types of collaboration targets (Map, Layer, Organization) |
| E-14      | CollaborationPermission | PermissionId:GUID (PK), PermissionName:VARCHAR(50), PermissionLevel:VARCHAR(20)                                                                                                    | PermissionId    |                                                                                                                                                       | 1–N with Collaboration                                                                                     | Permission levels for collaborations (read, write, admin) |
| E-15      | OrganizationMember      | MemberId:GUID (PK), OrgId:GUID (FK), UserId:GUID (FK), MembersRoleId:GUID (FK), InvitedBy:GUID (FK), JoinedAt:DATETIME, IsActive:BOOLEAN                                           | MemberId        | OrgId → Organization(OrgId), UserId → User(UserId), MembersRoleId → OrganizationMemberType(RoleId), InvitedBy → User(UserId)                          | N–1 with Organization, N–1 with User, N–1 with OrganizationMemberType, N–1 with User (inviter)             | Organization membership with roles and permissions        |
| E-16      | OrganizationMemberType  | RoleId:GUID (PK), RoleName:VARCHAR(50), RoleDescription:TEXT, Permissions:TEXT                                                                                                     | RoleId          |                                                                                                                                                       | 1–N with OrganizationMember                                                                                | Roles within organizations (admin, member, viewer)        |
| E-17      | OrganizationInvitation  | InvitationId:GUID (PK), OrgId:GUID (FK), Email:VARCHAR(100), RoleId:GUID (FK), InvitedBy:GUID (FK), Token:VARCHAR(255), ExpiresAt:DATETIME, Status:VARCHAR(20), CreatedAt:DATETIME | InvitationId    | OrgId → Organization(OrgId), RoleId → OrganizationMemberType(RoleId), InvitedBy → User(UserId)                                                        | N–1 with Organization, N–1 with OrganizationMemberType, N–1 with User                                      | Invitations to join organizations                         |

## Map & Annotation Entities

| Entity ID | Entity Name    | Attributes                                                                                                                       | PK           | FK                                                  | Relationships                         | Description                                        |
| --------- | -------------- | -------------------------------------------------------------------------------------------------------------------------------- | ------------ | --------------------------------------------------- | ------------------------------------- | -------------------------------------------------- |
| E-18      | Annotation     | AnnotationId:INT (PK), TypeId:GUID (FK), MapId:GUID (FK), Geometry:TEXT, Properties:TEXT, CreatedAt:DATETIME                     | AnnotationId | TypeId → AnnotationType(TypeId), MapId → Map(MapId) | N–1 with AnnotationType, N–1 with Map | Map annotations with geometry and properties       |
| E-19      | AnnotationType | TypeId:GUID (PK), TypeName:VARCHAR(50), TypeDescription:TEXT, IconUrl:VARCHAR(255), Color:VARCHAR(20)                            | TypeId       |                                                     | 1–N with Annotation                   | Types of annotations (marker, polygon, line, etc.) |
| E-20      | MapFeature     | FeatureId:GUID (PK), MapId:GUID (FK), FeatureType:ENUM, Geometry:TEXT, Properties:TEXT, Style:TEXT, CreatedAt:DATETIME           | FeatureId    | MapId → Map(MapId)                                  | N–1 with Map                          | Individual features within maps                    |
| E-21      | MapLayer       | MapLayerId:GUID (PK), MapId:GUID (FK), LayerId:GUID (FK), LayerOrder:INT, IsVisible:BOOLEAN, Opacity:DECIMAL, CreatedAt:DATETIME | MapLayerId   | MapId → Map(MapId), LayerId → Layer(LayerId)        | N–1 with Map, N–1 with Layer          | Junction table for maps and layers                 |
| E-22      | MapHistory     | HistoryId:GUID (PK), MapId:GUID (FK), Action:VARCHAR(50), Changes:TEXT, UserId:GUID (FK), CreatedAt:DATETIME                     | HistoryId    | MapId → Map(MapId), UserId → User(UserId)           | N–1 with Map, N–1 with User           | Version history for map changes                    |
| E-23      | MapImage       | ImageId:GUID (PK), MapId:GUID (FK), ImageUrl:VARCHAR(255), ImageType:VARCHAR(50), CreatedAt:DATETIME                             | ImageId      | MapId → Map(MapId)                                  | N–1 with Map                          | Images associated with maps                        |

## User Interaction Entities

| Entity ID | Entity Name          | Attributes                                                                                                                                            | PK                   | FK                                                                  | Relationships                               | Description                           |
| --------- | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | ------------------------------------------------------------------- | ------------------------------------------- | ------------------------------------- |
| E-24      | Bookmark             | BookmarkId:INT (PK), MapId:GUID (FK), UserId:GUID (FK), Name:VARCHAR(100), ViewState:TEXT, CreatedAt:DATETIME                                         | BookmarkId           | MapId → Map(MapId), UserId → User(UserId)                           | N–1 with Map, N–1 with User                 | User bookmarks for specific map views |
| E-25      | DataSourceBookmark   | DataSourceBookmarkId:INT (PK), UserId:GUID (FK), DataSourceName:VARCHAR(100), DataSourceUrl:VARCHAR(255), ViewState:TEXT, CreatedAt:DATETIME          | DataSourceBookmarkId | UserId → User(UserId)                                               | N–1 with User                               | Bookmarks for external data sources   |
| E-26      | Comment              | CommentId:INT (PK), MapId:GUID (FK), LayerId:GUID (FK), UserId:GUID (FK), Content:TEXT, Position:VARCHAR(100), CreatedAt:DATETIME, UpdatedAt:DATETIME | CommentId            | MapId → Map(MapId), LayerId → Layer(LayerId), UserId → User(UserId) | N–1 with Map, N–1 with Layer, N–1 with User | Comments on maps and layers           |
| E-27      | UserPreference       | PreferenceId:GUID (PK), UserId:GUID (FK), PreferenceKey:VARCHAR(100), PreferenceValue:TEXT, CreatedAt:DATETIME, UpdatedAt:DATETIME                    | PreferenceId         | UserId → User(UserId)                                               | N–1 with User                               | User preferences and settings         |
| E-28      | UserFavoriteTemplate | FavoriteId:GUID (PK), UserId:GUID (FK), MapId:GUID (FK), CreatedAt:DATETIME                                                                           | FavoriteId           | UserId → User(UserId), MapId → Map(MapId)                           | N–1 with User, N–1 with Map                 | User's favorite map templates         |
| E-29      | UserAccessTool       | UserAccessToolId:INT (PK), UserId:GUID (FK), AccessToolId:INT (FK), GrantedAt:DATETIME, ExpiresAt:DATETIME                                            | UserAccessToolId     | UserId → User(UserId), AccessToolId → AccessTool(AccessToolId)      | N–1 with User, N–1 with AccessTool          | User access to specific tools         |

## System & Utility Entities

| Entity ID | Entity Name   | Attributes                                                                                                                                                                           | PK              | FK                                                                                                                    | Relationships                                                                               | Description                                                 |
| --------- | ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| E-30      | UserRole      | RoleId:GUID (PK), Name:VARCHAR(50)                                                                                                                                                   | RoleId          |                                                                                                                       | 1–N with User                                                                               | User roles (admin, user, guest, etc.)                       |
| E-31      | AccountStatus | AccountStatusId:GUID (PK), StatusName:VARCHAR(50)                                                                                                                                    | AccountStatusId |                                                                                                                       | 1–N with User                                                                               | Account status (active, suspended, banned, etc.)            |
| E-32      | AccessTool    | AccessToolId:INT (PK), AccessToolName:VARCHAR(100), AccessToolDescription:TEXT, IconUrl:VARCHAR(255), RequiredMembership:BOOLEAN                                                     | AccessToolId    |                                                                                                                       | 1–N with UserAccessTool                                                                     | Available access tools and features                         |
| E-33      | Notification  | NotificationId:INT (PK), UserId:GUID (FK), Type:VARCHAR(50), Message:TEXT, Status:VARCHAR(20), CreatedAt:DATETIME, SentAt:DATETIME                                                   | NotificationId  | UserId → User(UserId)                                                                                                 | N–1 with User                                                                               | System notifications for users                              |
| E-34      | SupportTicket | TicketId:INT (PK), UserId:GUID (FK), Subject:VARCHAR(200), Message:TEXT, StatusId:GUID (FK), Priority:VARCHAR(20), CreatedAt:DATETIME, ResolvedAt:DATETIME                           | TicketId        | UserId → User(UserId), StatusId → TicketStatus(StatusId)                                                              | N–1 with User, N–1 with TicketStatus                                                        | Customer support tickets                                    |
| E-35      | TicketStatus  | StatusId:GUID (PK), StatusName:VARCHAR(50)                                                                                                                                           | StatusId        |                                                                                                                       | 1–N with SupportTicket                                                                      | Support ticket status (open, in-progress, resolved, closed) |
| E-36      | Export        | ExportId:INT (PK), UserId:GUID (FK), MembershipId:GUID (FK), MapId:GUID (FK), FilePath:VARCHAR(255), FileSize:INT, ExportTypeId:GUID (FK), QuotaType:VARCHAR(20), CreatedAt:DATETIME | ExportId        | UserId → User(UserId), MembershipId → Membership(MembershipId), MapId → Map(MapId), ExportTypeId → ExportType(TypeId) | N–1 with User, N–1 with Membership, N–1 with Map, N–1 with ExportType, 1–N with Transaction | Map exports with file information                           |
| E-37      | ExportType    | TypeId:GUID (PK), TypeName:VARCHAR(50), FileExtension:VARCHAR(10), MimeType:VARCHAR(100)                                                                                             | TypeId          |                                                                                                                       | 1–N with Export                                                                             | Export file types (PDF, PNG, KML, etc.)                     |
| E-38      | Advertisement | AdvertisementId:INT (PK), AdvertisementTitle:VARCHAR(200), AdvertisementContent:TEXT, ImageUrl:VARCHAR(255), StartDate:DATETIME, EndDate:DATETIME, IsActive:BOOLEAN                  | AdvertisementId |                                                                                                                       |                                                                                             | System advertisements and promotions                        |
| E-39      | Faq           | FaqId:INT (PK), Question:TEXT, Answer:TEXT, Category:VARCHAR(100), CreatedAt:DATETIME                                                                                                | FaqId           |                                                                                                                       |                                                                                             | Frequently asked questions and answers                      |

## Supporting Enums and Types

| Entity ID | Entity Name                | Attributes                                         | PK           | FK  | Relationships | Description                                           |
| --------- | -------------------------- | -------------------------------------------------- | ------------ | --- | ------------- | ----------------------------------------------------- |
| E-40      | LayerType                  | TypeId:GUID (PK), TypeName:VARCHAR(50)             | TypeId       |     |               | Layer types (raster, vector, WMS, etc.)               |
| E-41      | LayerSource                | SourceId:GUID (PK), SourceName:VARCHAR(50)         | SourceId     |     |               | Layer source types (file upload, URL, database, etc.) |
| E-42      | OrganizationLocationStatus | StatusId:GUID (PK), StatusName:VARCHAR(50)         | StatusId     |     |               | Organization location status types                    |
| E-43      | MembershipPlanType         | TypeId:GUID (PK), TypeName:VARCHAR(50)             | TypeId       |     |               | Membership plan types (basic, premium, enterprise)    |
| E-44      | MembershipStatus           | StatusId:GUID (PK), StatusName:VARCHAR(50)         | StatusId     |     |               | Membership status types (active, expired, suspended)  |
| E-45      | PaymentGateway             | GatewayId:GUID (PK), GatewayName:VARCHAR(50)       | GatewayId    |     |               | Payment gateway types (PayOS, Stripe, PayPal)         |
| E-46      | TicketStatus               | StatusId:GUID (PK), StatusName:VARCHAR(50)         | StatusId     |     |               | Support ticket status types                           |
| E-47      | ExportType                 | TypeId:GUID (PK), TypeName:VARCHAR(50)             | TypeId       |     |               | Export file type definitions                          |
| E-48      | AnnotationType             | TypeId:GUID (PK), TypeName:VARCHAR(50)             | TypeId       |     |               | Annotation type definitions                           |
| E-49      | CollaborationPermission    | PermissionId:GUID (PK), PermissionName:VARCHAR(50) | PermissionId |     |               | Collaboration permission levels                       |
| E-50      | CollaborationTargetType    | TypeId:GUID (PK), TypeName:VARCHAR(50)             | TypeId       |     |               | Collaboration target type definitions                 |
